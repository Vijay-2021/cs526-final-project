# Hydride

Hydride is a retargetable and extensible synthesis-based compiler for modern hardware architectures. Checkout the [wiki page](https://github.com/AkashIwnK/Hydride/wiki) for details.

Hydride has two major components:
- CodeGen Generator - It is responsible for automatically generating target-agnostic DSL in Rosette for synthesis, LLVM IR extensions and legalization code.
- Code Synthesizer - It leverages Rosette to synthesize tensor and stencil computations using the DSL automatically generated by the Backend.

## Prerequisites

### Python
- Install [Python](https://www.python.org/downloads/) > 3.0.

### Z3
- Install [z3](https://github.com/Z3Prover/z3):
    - MacOS: `brew install z3`
    - Linux example: `sudo apt-get install -y z3`

### Racket 
- Install [Racket](https://download.racket-lang.org/)
    - Linux example (works for all versions of Racket): 
    ```bash
    wget https://download.racket-lang.org/installers/8.6/racket-8.6-x86_64-linux-cs.sh
    sh racket-8.6-x86_64-linux-cs.sh
    ```

## Directory Structure
- `code-syntheizer` contains the experimental files for adding the notion of cost for different benchmark kernels and code for grammar generator.
- `codegen-generator` contains the custom compiler to generate target-agnostic semantics for target ISAs in Rosette for synthesis, LLVM IR extensions and legalization code for generating low-level code executable on a given supported target.
- `frontends` contains modified versions of DSL compilers Hydride supports (Halide and MLIR).
- `backends` contains modified version of low-level compilers like LLVM that contains backends to different targets.
- `rosette` is the modified version of Rosette necessary for Hydride.
- `benchmarks` contains the benchmarks on which Hydride is evaluated against other mainline DSL compilers.

## Instructions to install Hydride
From the root directory, run the setup bash script to set up appropriate paths first.
```
source setup.sh
```
Install the frontends and backends, and Rosette and Hydride code synthesizer by running the following install script. 
```
bash install.sh
```
Now you are ready to use Hydride!

## Targets Supported (WIP)
- x86 (SSE, AVX (includes VNNI, AMX, etc.), MMX, FMA)
- Hexagon (HVX)
- ARM A64
    - succeed
        - average_pool
        - gaussian5x5
        - gaussian3x3
        - max_pool
        - median3x3
        - dilate5x5
        - dilate3x3
        - matmul_256_32bit
        - blur3x3: repeat_edge or /3
    - failed:
        - mul: shl
        - l2norm: ?
        - add: shl, sat, rsr


arm average_pool
7.812633333333333
arm-disable-hydride average_pool
3.509733333333333
arm gaussian5x5
2.9326666666666665
arm-disable-hydride gaussian5x5
2.950366666666667
arm gaussian3x3
1.9369333333333334
arm-disable-hydride gaussian3x3
1.9039000000000001
arm max_pool
1.9588999999999999
arm-disable-hydride max_pool
1.9570333333333334
arm median3x3
3.4317333333333333
arm-disable-hydride median3x3
3.4486666666666665
arm dilate5x5
1.2073333333333334
arm-disable-hydride dilate5x5
1.2523333333333333
arm dilate3x3
1.2126000000000001
arm-disable-hydride dilate3x3
1.2299333333333333
arm blur3x3
2.136433333333333
arm-disable-hydride blur3x3
2.078533333333333
arm sobel3x3
3.1666000000000003
arm-disable-hydride sobel3x3
2.6621
arm matmul_256_32bit
1.6552666666666667
arm-disable-hydride matmul_256_32bit
1.8769


hydride_optimize_arm
