#lang rosette
;#lang rosette/safe

(require rosette/lib/synthax)
(require rosette/lib/angelic)
(require rosette/lib/destruct)
(require
  (only-in racket/base error bitwise-and)
  rosette/lib/destruct
  hydride/cpp
  hydride/utils/bvops
  hydride/ir/arith/types)

(provide (prefix-out arith: (all-defined-out)))



;; Infer the length of vector generated by the expression
(define (visit expr handler)
  (destruct expr
            [(arith:tensor data shape layout elemT buffsize id) (handler expr)]
            [(arith:tensor-add v1 v2) (handler (arith:tensor-add (visit v1 handler) (visit v2 handler)))]
            [_ (handler expr)]
            )
  )
